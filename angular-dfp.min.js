"use strict";var googletag=googletag||{};googletag.cmd=googletag.cmd||[],angular.module("ngDfp",[]).constant("ngDfpUrl","//www.googletagservices.com/tag/js/gpt.js").provider("DoubleClick",["ngDfpUrl",function(e){var t={},n={},i={},o={},r=null,a=!0,g={},s=!1;this._createTag=function(t){if(a){var n=document.createElement("script"),i="https:"===document.location.protocol,o=document.getElementsByTagName("script")[0];n.async=!0,n.type="text/javascript",n.src=(i?"https:":"http:")+e,o.parentNode.insertBefore(n,o),n.onreadystatechange=function(){"complete"==this.readyState&&t()},n.onload=t}},this._initialize=function(){var e=this;googletag.cmd.push(function(){angular.forEach(t,function(e,t){var n=e.getSlotTargeting();n&&angular.forEach(n,function(e,n){i[t].setTargeting(e.id,e.value)})}),angular.forEach(n,function(e,t){i[t]=googletag.defineOutOfPageSlot(e[0],e[2]).addService(googletag.pubads())}),angular.forEach(g,function(e,t){googletag.pubads().setTargeting(t,e)}),s&&googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.pubads().addEventListener("slotRenderEnded",e._slotRenderEnded)})},this._slotRenderEnded=function(e){var n=t[e.slot.getSlotId().getDomId()].renderCallback;"function"==typeof n&&n()},this._refreshInterval=function(){return r},this.setRefreshInterval=function(e){return r=e,this},this.defineSlot=function(){var e=arguments;return e.getSize=function(){return this[1]},e.getSlotTargeting=function(){return this[3]?this[3]:!1},e.setRenderCallback=function(e){this.renderCallback=e},t[arguments[2]]=e,this},this.defineOutOfPageSlot=function(){var e=arguments;return e.getSize=function(){return!1},e.getSlotTargeting=function(){return this[3]?this[3]:!1},e.setRenderCallback=function(e){this.renderCallback=e},t[arguments[1]]=e,this},this.defineSizeMapping=function(){var e=arguments[0];return o[e]||(o[e]=[]),this.addSize=function(){return o[e].push([arguments[0],arguments[1]]),this},this},this.setEnabled=function(e){a=e},this.setPageTargeting=function(e,t){g[e]=t},this.collapseEmptyDivs=function(){s=!0};var u=this;this.$get=["$q","$window","$interval",function(e,n,r){var a=e.defer();return u._createTag(function(){u._initialize(),null!==u._refreshInterval()&&r(function(){googletag.cmd.push(function(){n.googletag.pubads().refresh()})},u._refreshInterval()),a.resolve()}),{getAdSize:function(e){return a.promise.then(function(){var n=t[e];if(angular.isUndefined(n))throw"Slot "+e+" has not been defined. Define it using DoubleClickProvider.defineSlot().";return t[e][1]})},getSlot:function(e){return a.promise.then(function(){var n=t[e];if(angular.isUndefined(n))throw"Slot "+e+" has not been defined. Define it using DoubleClickProvider.defineSlot().";return googletag.cmd.push(function(){void 0==n[2]?i[e]=googletag.defineOutOfPageSlot.apply(null,n).addService(googletag.pubads()):i[e]=googletag.defineSlot.apply(null,n).addService(googletag.pubads()),o[e]&&i[e].defineSizeMapping(o[e])}),t[e]})},fireAd:function(e){googletag.cmd.push(function(){u._initialize()})},runAd:function(e){googletag.cmd.push(function(){n.googletag.display(e)})},refreshAds:function(){var e=[];angular.forEach(arguments,function(t){e.push(i[t])}),googletag.cmd.push(function(){n.googletag.pubads().refresh(e)})},setKeyword:function(e){googletag.cmd.push(function(){n.googletag.pubads().setTargeting("kw",e).display()})}}}]}]).directive("ngDfpAdContainer",function(){return{restrict:"A",controller:["$element",function(e){function t(t){"visibility"===t?e.css("visibility","hidden"):e.hide()}function n(t){"visibility"===t?e.css("visibility","visible"):e.show()}this.$$setVisible=function(e,i){e?n(i):t(i)}}]}}).directive("ngDfpAd",["$timeout","$parse","$interval","DoubleClick",function(e,t,n,i){return{restrict:"A",template:'<div id="{{adId}}"></div>',require:"?^ngDfpAdContainer",scope:{adId:"@ngDfpAd",refresh:"@ngDfpAdRefresh",interval:"@ngDfpAdRefreshInterval",timeout:"@ngDfpAdRefreshTimeout"},replace:!0,link:function(t,o,r,a){t.$watch("adId",function(g){o.html("");var s=null;i.getSlot(g).then(function(u){i.fireAd(g);var l=u.getSize();i.refreshAds(g),l&&o.css("width",l[0]).css("height",l[1]),e(function(){i.runAd(g)}),a&&u.setRenderCallback(function(){if(angular.isDefined(r.ngDfpAdHideWhenEmpty)){var e=o.find("iframe:not([id*=hidden])").map(function(){return this.contentWindow.document});0==e.find("body").children().length||1==e.find("img").attr("width")?a.$$setVisible(!1,r.ngDfpAdHideWhenEmpty):a.$$setVisible(!0,r.ngDfpAdHideWhenEmpty)}}),t.$watch("refresh",function(e){angular.isUndefined(e)||i.refreshAds(g)}),t.$watch("interval",function(e){angular.isUndefined(e)||(n.cancel(s),s=n(function(){i.refreshAds(g)},t.interval))}),t.$watch("timeout",function(n){angular.isUndefined(n)||e(function(){i.refreshAds(g)},t.timeout)})},function(e){console.log(e)})})}}}]);
